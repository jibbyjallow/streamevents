{% load static %}

<div class="chat-container border rounded" id="chat-container" data-event-id="{{ event.pk }}">
    <div class="chat-header d-flex justify-content-between align-items-center bg-light p-3 border-bottom">
        <h5 class="mb-0">ğŸ’¬ Xat en Directe - {{ event.title }}</h5>
        <span class="badge bg-primary" id="message-count">0</span>
    </div>

    <div id="chat-messages" class="chat-messages p-3">
        <!-- Es carregaran via JavaScript -->
    </div>

    {% if user.is_authenticated and event.status == 'live' %}
        <form id="chat-form" class="chat-form d-flex gap-2 p-3 border-top">
            {% csrf_token %}
            
            <!-- Renderitza manualment el camp message si cal -->
            {% if chat_form %}
                {{ chat_form.message }}
            {% else %}
                <textarea 
                    name="message" 
                    class="form-control" 
                    rows="2" 
                    placeholder="Escriu un missatge..." 
                    maxlength="500"
                    required></textarea>
            {% endif %}
            
            <button type="submit" class="btn btn-primary px-4">
                <i class="bi bi-send"></i> Enviar
            </button>
        </form>
        
        <div id="chat-errors" class="text-danger p-2"></div>

    {% elif not user.is_authenticated %}
        <div class="p-3 text-center text-muted bg-light">
            <i class="bi bi-lock"></i> Inicia sessiÃ³ per participar al xat
        </div>

    {% else %}
        <div class="p-3 text-center text-muted bg-light">
            <i class="bi bi-clock"></i> El xat nomÃ©s estÃ  disponible durant l'esdeveniment en directe
        </div>
    {% endif %}
</div>

<!-- CSS i JS -->
<link rel="stylesheet" href="{% static 'xat/chat.css' %}">
<script src="{% static 'xat/chat.js' %}"></script>